<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Course Search</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        input { width: 300px; padding: 5px; margin-bottom: 10px; }
        .course { padding: 5px; border-bottom: 1px solid #ddd; }
    </style>
</head>
<body>

    <h2>Search Courses</h2>
    <input type="text" id="searchInput" placeholder="Search for a course..." onkeyup="searchCourses()">
    <div id="results"></div>

    <script>
        let courses = [];

        /*
        fetch('http://data_layer_api:5000/api/courses')  // Replaced static JSON with API / backend service
            .then(response => response.json())
            .then(data => {
                console.log("‚úÖ API Response:", JSON.stringify(data, null, 2));

                if (Array.isArray(data) && data.length > 0) {
                    courses = data;  // Directly assign API response as course data
                    console.log("‚úÖ Extracted Courses:", courses);
                } else {
                    console.error("‚ùå API returned no data!");
                    courses = [];
                }
            })
            .catch(error => console.error('‚ùå Error fetching API data:', error));
        */


        fetch('http://localhost:5003/course/query', {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({}) // Adjust the payload based on API requirements
        })
        .then(response => response.json())
        .then(data => console.log("Course Data:", data))
        .catch(error => console.error("Error fetching course data:", error));
        

        // Search courses function
        function searchCourses() {
            let query = document.getElementById('searchInput').value.toLowerCase();
            let resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = ""; // Clear previous results

            if (query.length < 2) return; // Ignore very short queries

            if (!courses || courses.length === 0) {
                console.error("‚ùå No courses available to search! Check JSON extraction.");
                return;
            }

            console.log("üîé Searching for:", query);
            console.log("üì¶ Total Courses Available:", courses.length);

            let filtered = courses.filter(course => {
                if (!course || !course.name) {
                    console.warn("‚ö†Ô∏è Skipping invalid course object:", course);
                    return false;
                }

                let courseName = course.name.toLowerCase();
                return courseName.includes(query);
            });

            console.log("‚úÖ Filtered Results:", filtered);

            if (filtered.length === 0) {
                resultsDiv.innerHTML = "<p>No results found</p>";
            } else {
                filtered.forEach(course => {
                    let div = document.createElement('div');
                    div.className = 'course';
                    div.innerHTML = `
                        <strong>${course.name}</strong><br>
                        <img src="${course.imageUrl || ''}" alt="${course.name}" style="max-width: 200px;"><br>
                        <a href="https://www.coursera.org${course.url}" target="_blank">View Course</a><br>
                        <p>Rating: ${course.avgProductRating ? course.avgProductRating.toFixed(2) : "N/A"} ‚≠ê</p>
                    `;
                    resultsDiv.appendChild(div);
                });
            }
        }


    </script>

</body>
</html>
