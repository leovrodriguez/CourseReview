<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Course Search</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        input { width: 300px; padding: 5px; margin-bottom: 10px; }
        .course { padding: 5px; border-bottom: 1px solid #ddd; }
    </style>
</head>
<body>

    <h2>Search Courses</h2>
    <input type="text" id="searchInput" placeholder="Search for a course..." onkeyup="searchCourses()">
    <div id="results"></div>

    <script>
        let courses = [];

        // Load the JSON file from the frontend folder
        fetch('all_entries.json')
            .then(response => response.json())
            .then(data => {
                console.log("‚úÖ Full JSON Loaded:", JSON.stringify(data, null, 2)); // Log the full JSON

                // Ensure `data` is extracted from the array correctly
                if (Array.isArray(data) && data.length > 0) {
                    data = data[0]; // Extract the first object from the array
                } else {
                    console.error("‚ùå JSON is not in the expected array format!");
                    console.log("üîç Data received:", JSON.stringify(data, null, 2));
                    return;
                }

                if (data?.data?.SearchResult?.search) {
                    let extractedCourses = [];

                    // Loop through each search entry and extract `elements`
                    data.data.SearchResult.search.forEach((item, index) => {
                        if (item?.elements) {
                            extractedCourses.push(...item.elements);
                        } else {
                            console.warn(`‚ö†Ô∏è Warning: Missing 'elements' in search index ${index}`, item);
                        }
                    });

                    courses = extractedCourses;
                    console.log("‚úÖ Extracted Courses:", courses);
                } else {
                    console.error("‚ùå Unexpected JSON structure! Check the data format.");
                    console.log("üîç Data received:", JSON.stringify(data, null, 2)); // Show full JSON
                    courses = [];
                }
            })
            .catch(error => console.error('‚ùå Error loading JSON:', error));


        // Search courses function
        function searchCourses() {
            let query = document.getElementById('searchInput').value.toLowerCase();
            let resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = ""; // Clear previous results

            if (query.length < 2) return; // Ignore very short queries

            if (!courses || courses.length === 0) {
                console.error("‚ùå No courses available to search! Check JSON extraction.");
                return;
            }

            console.log("üîé Searching for:", query);
            console.log("üì¶ Total Courses Available:", courses.length);

            let filtered = courses.filter(course => {
                if (!course || !course.name) {
                    console.warn("‚ö†Ô∏è Skipping invalid course object:", course);
                    return false;
                }

                let courseName = course.name.toLowerCase();
                return courseName.includes(query);
            });

            console.log("‚úÖ Filtered Results:", filtered);

            if (filtered.length === 0) {
                resultsDiv.innerHTML = "<p>No results found</p>";
            } else {
                filtered.forEach(course => {
                    let div = document.createElement('div');
                    div.className = 'course';
                    div.innerHTML = `
                        <strong>${course.name}</strong><br>
                        <img src="${course.imageUrl || ''}" alt="${course.name}" style="max-width: 200px;"><br>
                        <a href="https://www.coursera.org${course.url}" target="_blank">View Course</a><br>
                        <p>Rating: ${course.avgProductRating ? course.avgProductRating.toFixed(2) : "N/A"} ‚≠ê</p>
                    `;
                    resultsDiv.appendChild(div);
                });
            }
        }


    </script>

</body>
</html>
